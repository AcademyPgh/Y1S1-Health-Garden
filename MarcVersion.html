<!DOCTYPE HTML>
<html>
  <head>
    <style>
    #toDoField {
      display: none;
    }

    .dragged {
      z-index: 101;
    }

    .cell
    {
        position: relative;
        display: inline-block;
        margin: 0px;
        padding: 0px;
        border: 0px;
        width: 128px;
        height: 128px;
    }
    .cell img
    {
    	width: 35px;
        image-rendering: pixelated;
        position: absolute;
        top: 0px;
        left: 0px;
        width: 128px;
        height: 128px;
    }
    img {
        image-rendering: pixelated;
        width: 128px;
        height: 128px;
    }

    button {
      background-image: ./assets/next_day.png
      width: 128px;
      height: 128px;

    }

    .lockedItem{
      display: none;
    }
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"   integrity="sha256-xNjb53/rY+WmG+4L6tTl9m6PpqknWZvRt0rO1SRnJzw="   crossorigin="anonymous"></script>
    <script src="https://code.createjs.com/soundjs-0.6.2.min.js"></script>
  </head>
  <body onload="loadSound();">
    <button onclick='stopAllSound();'>Stop Sounds</button>
    <button onclick='playSong("song1");'>Play 1st Song</button>
    <button onclick='playSong("song2");'>Play Another Song</button>
    <button onclick='playSound("water");'>Play water sound</button>
    <button onclick='playSound("jingle");'>Play jingle sound</button>
    <button onclick='playSound("rake");'>Play rake sound</button>
    <button onclick='playSound("click");'>Play button click sound</button>
    <button onclick='playTransition("jingle", "rake");'>Play transition</button>
    <button onclick='muteSound();'>Mute Sound</button>
    <div class="toolbar">
      <!--
      The id associated with each graphic MUST be the name with "01" added at the end.
      The locked plants must be the name without the "01".
      This is necessary for unlockGraphic() to function correctly.

      The parameters that unlockGraphic has are: the id of the plant that is locked (sunflower NOT sunflower01),
      and the amount of sunshine it costs to buy that plant
    -->
      <button onclick="updateGame();" id="nextday">Next Day</button>
      <img src='./assets/spade.png' id="spade01" data-id="terraform" >
      <img src='./assets/waterCan.png' id="water01" data-id="water" >
      <img src='./assets/tulip_icon.png' id="tulip01" data-id="tulip" >
      <img src='./assets/rose_icon.png' id="rose01" data-id="rose" class="lockedItem">
      <img src='./assets/rose_icon.png' id="rose" data-id="rose" onclick="unlockGraphic('rose', 10)">
      <img src='./assets/sunflower_icon.png' id="sunflower01" data-id="sunflower" class="lockedItem">
      <img src='./assets/sunflower_icon.png' id="sunflower" data-id="sunflower" onclick="unlockGraphic('sunflower', 20)">
      <img src='./assets/fertilizer_bag.png' id="fertilize01" data-id="fertilize" >
      <img src='./assets/house.png' id="house01" data-id="house">
      <img src='./assets/butterfly_icon.png' id="harvest01" data-id="harvest" >
    </div>

    <div class="gameboard"></div>
    <div id="toDoField">
      <p>Enter to-do items below:</p>
      <input id="task" type="text"><button id="add">Add</button>
      <div id="todos"></div>
      <button id="hideToDo">Exit list</button>
    </div>
    <div id="journalField">
      <p>Enter your journal entry below:</p>
      <textarea name="entry" maxlength="250" rows="5" cols="50" id="entry"></textarea><br>
      <label for="uneasiness">Uneasiness</label>
      <input type="range" name="uneasiness" min="0" max="10">
      <label for="anger">Anger</label>
      <input type="range" name="anger" min="0" max="10">
      <label for="anxiety">Anxiety</label>
      <input type="range" name="anxiety" min="0" max="10">
      <label for="apathy">Apathy</label>
      <input type="range" name="apathy" min="0" max="10">
      <label for="serenity">Serenity</label>
      <input type="range" name="serenity" min="0" max="10">
      <label for="euphoria">Euphoria</label>
      <input type="range" name="euphoria" min="0" max="10">
      <input type="submit" id="addJournal"><button id="hideJournal">Exit</button>
    </div>

    </body>
    <script>
    var isPlaying

    function loadSound(){
      createjs.Sound.registerSounds([{src:"./sound/watering-plants.wav", id:"water"}, {src:"./sound/dizzy-spells.mp3", id:"song1"}, {src:"./sound/hhavok-main.mp3", id:"song2"}, {src:"./sound/jingle-win.wav", id:"jingle"}, {src:"./sound/raking.wav", id:"rake"}, {src:"./sound/button-click.wav", id:"click"}]);
    };

    function playSong(songName){
      createjs.Sound.stop();
        isPlaying = createjs.Sound.play(songName, {loop: -1});
        // Commented out below is the function to set the volume for each song.
        // isPlaying.volume = isPlaying.volume * 1.0;
      };

    function playSound(soundEffect){
          createjs.Sound.play(soundEffect);
        };

    function stopAllSound(){
      createjs.Sound.stop();
    };

    function playTransition(soundEffect, songName){
      createjs.Sound.stop();
      var transition = createjs.Sound.play(soundEffect);
      transition.on("complete", playSound(songName))
    }

    function muteSound(){
      isPlaying.muted = !isPlaying.muted;
    }


    var ticksPerMinute = 6000;
    var currency = {sunshine:10, energy:100, addEnergy: Date.now() + 2 * (ticksPerMinute)}; //100 is the max energy
    var actionEnergyAmount = 10;
    var toDoListEnergy = 5;
    var journalSunshine = 20;
    var timedEnergy = 5;
    var energyMax = 100;
    var boardWidth = 5;
    var boardLength = 3;
    var teenPoints = 20;
    var adultPoints = 50;

      function unlockGraphic(lockedItemId, cost){
        var flowerCost = cost;
        if(currency.sunshine>=flowerCost){
          playSound("click")
          currency.sunshine = currency.sunshine - flowerCost;
          //console.log(currency.sunshine);
          $("#" + lockedItemId + "01").show();
          $("#" + lockedItemId).hide();
        }
      }

  var gameTick = 500;
  var graphicId = [
    {name:"blank", state:[]},
    {name:"rose", state:[]},
    {name:"tulip", state:[]},
    {name:"sunflower", state:[]},
    {name:"house", state:[]},
    {name: "alert", state:[]}];
  //GraphicId[0].state[0] is the default which has nothing to layer at all.
  graphicId[0].state[0] = "<img src='./assets/blank.png'>";
  graphicId[1].state[0] = "<img src='./assets/stage_1_baby.png'>";
  graphicId[1].state[1] = "<img src='./assets/stage_2_teen.png'>";
  graphicId[1].state[2] = "<img src='./assets/stage_3_rose.png'>";
  graphicId[2].state[0] = "<img src='./assets/stage_1_baby.png'>";
  graphicId[2].state[1] = "<img src='./assets/stage_2_teen.png'>";
  graphicId[2].state[2] = "<img src='./assets/stage_3_tulip.png'>";
  graphicId[3].state[0] = "<img src='./assets/stage_1_baby.png'>";
  graphicId[3].state[1] = "<img src='./assets/stage_2_teen.png'>";
  graphicId[3].state[2] = "<img src='./assets/stage_3_sunflower.png'>";
  graphicId[4].state[0] = "<img src='./assets/house.png'>";
  graphicId[5].state[0] = "<img src='./assets/exclamation_alert.png'>";

  gameBoard = new Array(boardLength);
  for (var i = 0; i < boardLength; i++) //This is essentially the model
  {
    gameBoard[i] = new Array(boardWidth);
    for (var j = 0; j < boardWidth; j++)
    {
      gameBoard[i][j] = {
        needTerraform: true,
        type: "blank",
        objectId: 0,
        stateId: 0,
        needFertilizer: true,
        nextFertilizer: Date.now(),
        harvest: false,
        growthPoints: 0,
        needWater: true,
        nextWater: Date.now(),
        effects: false
      };
    }
  }
  for (var x = 0; x < boardLength; x++){
    for (var y = 0; y < boardWidth; y++){
      var id = getId(x, y);
      //alert(id);
      $(".gameboard").append("<div style='display: inline-block' class='cell' id='" + id + "'></div>");
      //Fills in art layers for each cell.
      drawCell(x, y, id);
      //Gives each cell the attribute to have things able to be dropped on it.
      $("#" + id).droppable({
        drop: itemDropped, //drop is a function, when it's done, it calls the function John wrote
        hoverClass: "dragHover" //makes each cell "pop" out a bit for user?; needs written or needs deleted
      });
    }
    $(".gameboard").append("<br/>");
  }

  function itemDropped(event, ui){
    var id = this.id
    var dropped = ui.draggable.attr("data-id");
    //Splits the idea up into the coordinate locations in the array of arrays
    var location = id.split("-");
    var x = location[0];
    var y = location[1];
    console.log(dropped)
    switch (dropped){
      case "terraform":
        terraformCell(x, y, id)
      break;
      case "water":
          waterPlant(x, y, id)
          break;
      case "tulip":
          placeGraphic(x, y, id, dropped)
        break;
      case "rose":
          placeGraphic(x, y, id, dropped)
          break;
      case "sunflower":
          placeGraphic(x, y, id, dropped)
          break;
      case "fertilize":
        fertilizePlant(x, y, id)
          break;
      case "house":
        placeGraphic(x, y, id, dropped)
          break;
      case "harvest":
        harvestPlant(x, y, id)
        break;
        }
        drawCell(x, y, id);
      }
      function harvestPlant(x,y,id){
        if(gameBoard[x][y].stateId==2){
          gameBoard[x][y].type = "blank";
          gameBoard[x][y].stateId = 0;
          console.log(gameBoard[x][y].stateId);
          console.log(gameBoard[x][y].type);
          gameBoard[x][y].harvest = true;
          currency.sunshine = 10;
        }

      }
      function waterPlant(x,y,id){
        if(gameBoard[x][y].type!="blank" && gameBoard[x][y].type!="house"){
          gameBoard[x][y].needWater=false;
          playSound("water")
          gameBoard[x][y].nextWater=Date.now() + 5 * (ticksPerMinute);
          if (gameBoard[x][y].stateId == 0 && gameBoard[x][y].growthPoints <= teenPoints)
            { gameBoard[x][y].growthPoints += 1;}
          if (gameBoard[x][y].stateId == 1)
            { gameBoard[x][y].growthPoints += 1;}
        }
      }
      function fertilizePlant(x, y, id)
      {
        if(currency.energy >= actionEnergyAmount && (gameBoard[x][y].type!="blank" && gameBoard[x][y].type!="house")){
          gameBoard[x][y].needFertilizer = false;
          playSound("jingle")
          currency.energy = currency.energy - actionEnergyAmount;
          gameBoard[x][y].nextFertilizer=Date.now() + 5 * (ticksPerMinute);
          if (gameBoard[x][y].stateId == 0 && gameBoard[x][y].growthPoints <= teenPoints)
          {gameBoard[x][y].growthPoints += 10;}
          if (gameBoard[x][y].stateId == 1)
          { gameBoard[x][y].growthPoints += 10;}
        }
      }
      function terraformCell(x,y,id) {
        //  if it's a house don't do it, or if it's already terraformed
        if(currency.energy >= actionEnergyAmount && (gameBoard[x][y].type!="House" || gameBoard[x][y].needTerraform==false))
        {
          gameBoard[x][y].needTerraform = false;
          playSound("rake")
          currency.energy = currency.energy - actionEnergyAmount;
        }
      }
      function playEffect(x, y, id)
      {
        gameBoard[x][y].effects == "true";
      }
      function placeGraphic(x,y,id, dropped){
        if(dropped=="house"){
          gameBoard[x][y].type = "house";
          gameBoard[x][y].objectId = 4;
          gameBoard[x][y].stateId = 0;
        }
        if(gameBoard[x][y].needTerraform==false && gameBoard[x][y].type=="blank" && currency.energy >= actionEnergyAmount)
        {
          if(dropped=="house"){
            playSound("jingle")
            gameBoard[x][y].type = "house";
            gameBoard[x][y].objectId = 5;
            gameBoard[x][y].stateId = 0;
          }
          else if (dropped=="rose") {
            gameBoard[x][y].type = "rose";
            gameBoard[x][y].objectId = 1;
            gameBoard[x][y].stateId = 0;
          }
          else if (dropped=="tulip") {
            gameBoard[x][y].type = "tulip";
            gameBoard[x][y].objectId = 2;
            gameBoard[x][y].stateId = 0;
          }
          else if (dropped=="sunflower") {
            gameBoard[x][y].type = "sunflower";
            gameBoard[x][y].objectId = 3;
            gameBoard[x][y].stateId = 0;
          }
          currency.energy = currency.energy - actionEnergyAmount;
        }
      }

      function getId(x, y)
      {
        return x.toString() + "-" + y.toString();
      }

      function updateGame(){
        currency.energy = 100;
      	for(var i=0; i<boardLength; i++){
      		for(var j=0; j<boardWidth; j++){
      			nextDay(i,j)
      		}
      	}
      }

      function nextDay(x,y){
      	var maxstateId = 2;
      	var midstateId = 1;
        var id = getId(x, y);



      	//refill energy

      	//playTransition("");
      	//playSong("");
      	if (gameBoard[x][y].type != "blank" && gameBoard[x][y].type != "house")
        {
      		  gameBoard[x][y].needWater = true;
            gameBoard[x][y].nextWater = Date.now();
            gameBoard[x][y].needFertilizer=true;
            gameBoard[x][y].nextFertilizer=Date.now();
      		if (gameBoard[x][y].stateId < midstateId && gameBoard[x][y].growthPoints >= teenPoints)
          {
      			//gameboard[i][j].stateId = 1
      			gameBoard[x][y].stateId=1;
      			//gameboard[i][j].needFertilizer = true

            drawCell(x, y, id)
      		}
      		else if (gameBoard[x][y].stateId < maxstateId && gameBoard[x][y].growthPoints >= adultPoints){
      			//gameboard[i][j].stateId = 2
      			gameBoard[x][y].stateId=2;
      			//gameboard[i][j].needFertilizer = true
            drawCell(x, y, id)
      		}
      	}
      }


      function drawCell(x,y,id)
      {
        $("#" + id).html("");
        if (gameBoard[x][y].needTerraform == true){
          $("#" + id).append("<img src='./assets/un_terraformed_dirt.png'>");
        }
        else{
          $("#" + id).append("<img src='./assets/terraformed_dirt.png'>");
        }
        if (gameBoard[x][y].needWater != true){
            $("#" + id).append("<img src='./assets/watered.png'>");
          }
        if (gameBoard[x][y].needFertilizer != true){
          $("#" + id).append("<img src='./assets/fertilized.png'>");
          }


          var i = 0;
        do {
          $("#" + id).append(graphicId[gameBoard[x][y].objectId].state[i]);
          i++;
        } while(i <= gameBoard[x][y].stateId);

          if (gameBoard[x][y].harvest == true){
            $("#" + id).append("<img src='./assets/terraformed_dirt.png'>");
            }
          if (gameBoard[x][y].effects == true){
            $("#" + id).append("<img src='./assets/butterflies.gif'>");
          }
          addToDoToHouse(x,y);
      }


        $("#house01").draggable({
          container: document,
          helper: houseHelper
        });
        function houseHelper(){
          return "<img src='./assets/house.png' class='dragged'>"
        }
        $("#fertilize01").draggable({
          container: document,
          helper: fertilizerHelper
        });
        function fertilizerHelper(){
          return "<img src='./assets/fertilizer_bag.png' class='dragged'>"
        }
        $("#water01").draggable({
          container: document,
          helper: waterHelper
        });
        function waterHelper(){
          return "<img src='./assets/happy_cloud.gif' class='dragged'>"
        }
        $("#spade01").draggable({
          container: document,
          helper: spadeHelper
        });
        function spadeHelper(){
          return "<img src='./assets/spade.png' class='dragged'>"
        }
        $("#tulip01").draggable({
          container: document,
          helper: tulipHelper
        });
        function tulipHelper(){
          return "<img src='./assets/stage_1_baby.png' class='dragged'>"
        }
        $("#rose01").draggable({
          container: document,
          helper: roseHelper
        });
        function roseHelper(){
          return "<img src='./assets/stage_1_baby.png' class='dragged'>"
        }
        $("#sunflower01").draggable({
          container: document,
          helper: sunflowerHelper
        });
        function sunflowerHelper(){
          return "<img src='./assets/stage_1_baby.png' class='dragged'>"
        }
        $("#harvest01").draggable({
          container: document,
          helper: harvestHelper
        });
        function harvestHelper(){
          return "<img src='./assets/butterfly_icon.png' class='dragged'>"
        }
        function gameLoop ()
        {
          for (var x = 0; x < boardLength; x++)
          {
            for (var y = 0; y < boardWidth; y++)
            {
              if (gameBoard[x][y].nextWater < Date.now() && gameBoard[x][y].needWater == false)
              {
                var id = x.toString() + "-" + y.toString();
                gameBoard[x][y].needWater = true;
                drawCell(x, y, id);
                gameBoard[x][y].nextWater = Date.now() + 5 * (ticksPerMinute);
              }
              if (gameBoard[x][y].nextFertilizer < Date.now() && gameBoard[x][y].needFertilizer == false)
              {
                var id = x.toString() + "-" + y.toString();
                gameBoard[x][y].needFertilizer = true;
                drawCell(x, y, id);
              }
            }
          }

          if (currency.addEnergy < Date.now() && currency.energy < energyMax)
              {
                currency.energy++;
              }
          setTimeout(gameLoop, gameTick);
        }

        gameLoop();

      function addToDoToHouse(x,y){
        if (gameBoard[x][y].objectId == 4){
          $(".toolbar #house01").remove();
          var id = ".gameboard #" + x + "-" + y;
          $(id).addClass("house01");
          $(".house01").click(function(){
              $("#toDoField").show();
          });
          $(".house01").css({ cursor: "pointer" });
        }
      }

      $("#hideToDo").click(function(){
          $("#toDoField").hide();
      });

      function get_todos() {
          var todos = new Array;
          var todos_str = localStorage.getItem('todo');
          if (todos_str !== null) {
              todos = JSON.parse(todos_str);
          }
          return todos;
      }

      function add() {
          var task = document.getElementById('task').value;

          var todos = get_todos();
          if (task !== ""){
            todos.push(task);
          }
          else {
            alert("Invalid entry. No text entered.");
          }
          localStorage.setItem('todo', JSON.stringify(todos));

          show();
          return false;
      }

      function remove() {
          var id = this.getAttribute('id');
          var todos = get_todos();
          todos.splice(id, 1);
          localStorage.setItem('todo', JSON.stringify(todos));

          show();

          return false;
      }

      function show() {
          var todos = get_todos();

          var html = '<ul>';
          for(var i=0; i<todos.length; i++) {
              html += '<li>' + todos[i] + '<button class="remove" id="' + i  + '">x</button>' + '<button class="accomplished" id="' + i + '">&#10003;</button>' + '</li>';
          };
          html += '</ul>';

          document.getElementById('todos').innerHTML = html;

          var buttons = document.getElementsByClassName('remove');
          for (var i=0; i < buttons.length; i++) {
              buttons[i].addEventListener('click', remove);
          };
      }

      document.getElementById('add').addEventListener('click', add);
      show();

      function get_entries() {
          var entries = new Array;
          var entry_str = localStorage.getItem('entry');
          if (entry_str !== null) {
              entries = JSON.parse(entry_str);
          }
          return entries;
      }

      function addJournal() {
          var entry = document.getElementById('entry').value;

          var entries = get_entries();
          if (entry !== ""){
            entries.push(entry);
          }
          else {
            alert("Invalid entry. No text entered.");
          }
          localStorage.setItem('entry', JSON.stringify(entries));
          return false;
      }

      function createJournalArray(){
        var entries = get_entries();
        var entryArray = [];

        for(var i = 0; i < entries.length; i++){
          entryArray.push(entries[i]);
        }
        console.log(entryArray);
      }

      document.getElementById('addJournal').addEventListener('click', addJournal);
</script>
</html>

<!--case "butterfly":
                gameBoard[x][y].effects = true;
                PlayEffect(x, y, id)
                break;

        }-->

<!--onload, localStorage.clear()?-->
